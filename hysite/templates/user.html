{% extends 'site-base.html' %}
{% load static %}
{% block title %}管理用户 - 风信子{% endblock %}
{% block page_title %}管理用户{% endblock %}

{% block ms-auto %}

<div class="btn-list">
    <a  class="btn btn-teal d-none d-sm-inline-block" data-bs-toggle="modal" data-bs-target="#modal-new-user">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><line x1="12" y1="5" x2="12" y2="19" /><line x1="5" y1="12" x2="19" y2="12" /></svg>
        新用户
    </a>
</div>
{% endblock %}

{% block page_body %}
<div class="row mb-3">
    <div  class="search"  style="width: 25%">
        <div class="input-icon">
            <span class="input-icon-addon">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7" /><line x1="21" y1="21" x2="15" y2="15" /></svg>
            </span>
            <input id="input-search" type="text" value="" class="form-control" placeholder="请输入用户名称" aria-label="Search in website">
        </div>
    </div>

    <div class="col-auto">
        <a onclick="seachUser()" class="btn btn-default">
            <svg t="1641283159024" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5702" width="200" height="200"><path d="M512 512m-512 0a512 512 0 1 0 1024 0 512 512 0 1 0-1024 0Z" fill="#41B6F7" p-id="5703"></path><path d="M719.36 691.2l-76.8-76.8c23.04-33.28 38.4-74.24 38.4-117.76 0-107.52-87.04-197.12-192-197.12s-192 87.04-192 197.12c0 110.08 87.04 197.12 192 197.12 48.64 0 92.16-17.92 128-48.64l76.8 76.8c7.68 7.68 20.48 7.68 25.6 0 7.68-10.24 7.68-23.04 0-30.72z m-227.84-33.28c-87.04 0-158.72-71.68-158.72-161.28s71.68-161.28 158.72-161.28c87.04 0 158.72 71.68 158.72 161.28-2.56 89.6-71.68 161.28-158.72 161.28z" fill="#FFFFFF" p-id="5704"></path></svg>
            查询
        </a>
    </div>
</div>

<div class="row row-cards">
    {% for user in users %}
    <div class="col-md-6 col-lg-3">
        <div class="card user-card">
            <div class="card-body  text-center">
                <span class="avatar avatar-md mb-2 avatar-rounded" style="background-image: url(/static/image/avatar.png);background-color: transparent"></span>
                <h3 class="m-0 mb-1 username">{{ user.username }}</h3>
                <div class="text-muted nickname">{{ user.nickname }}</div>
                {% if user.role == '管理员' %}
                <div class="mt-1">
                    <span class="badge bg-purple-lt">{{ user.role }}</span>
                </div>
                {% else %}
                <div class="mt-1">
                    <span class="badge bg-color-default">{{ user.role }}</span>
                </div>
                {% endif %}
                <div class="text-muted mt-1">加入时间: {{ user.ctime | date:'Y-m-d H:i:s' }}</div>
            </div>
            <div class="d-flex">
                <a onclick="getUserInfo('{{ user.username }}')" class="card-btn cursor-pointer" data-bs-toggle="modal" data-bs-target="#modal-user-info">
                    <svg t="1662273072052" class="icon me-2 text-muted" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="15466" width="2000" height="2000"><path d="M768 1024H256c-143.36 0-256-112.64-256-256V256c0-143.36 112.64-256 256-256h512c143.36 0 256 112.64 256 256v512c0 143.36-112.64 256-256 256zM614.4 271.36c-5.12-56.32-25.6-92.16-92.16-92.16H512c0-5.12-15.36-25.6-87.04-25.6C358.4 153.6 312.32 220.16 302.08 271.36c-10.24 51.2 10.24 97.28 10.24 97.28s-25.6 20.48-10.24 61.44c15.36 40.96 40.96 46.08 40.96 46.08s5.12 30.72 15.36 51.2c10.24 20.48 30.72 30.72 25.6 51.2-5.12 15.36-15.36 35.84-40.96 35.84-20.48 5.12-128 25.6-163.84 76.8-35.84 51.2-51.2 133.12 35.84 158.72 35.84 10.24 97.28 20.48 163.84 20.48 10.24 0 122.88 5.12 168.96 0 66.56-5.12 128-10.24 158.72-20.48 87.04-25.6 66.56-107.52 35.84-158.72-35.84-51.2-143.36-71.68-163.84-76.8-30.72-5.12-30.72-61.44-15.36-97.28 10.24-20.48 15.36-40.96 15.36-40.96s20.48-5.12 40.96-46.08c15.36-40.96-10.24-56.32-10.24-56.32s10.24-46.08 5.12-102.4z m256-15.36h-204.8v51.2h204.8V256z m0 153.6h-153.6v51.2h153.6V409.6z" fill="#68bf7b" p-id="15467"></path></svg>
                    信息
                </a>
                <a onclick="editUser('{{ user.username }}')" class="card-btn cursor-pointer" data-bs-toggle="modal" data-bs-target="#modal-edit-user">
                    <svg t="1638686685621" class="icon me-2 text-muted" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7671" width="200" height="200"><path d="M512 512m-512 0a512 512 0 1 0 1024 0 512 512 0 1 0-1024 0Z" fill="#5866C7" p-id="7672"></path><path d="M466.304 192l-0.064 64H320a64 64 0 0 0-63.552 56.512L256 320v384a64 64 0 0 0 56.512 63.552L320 768h384a64 64 0 0 0 63.552-56.512L768 704V557.696h64v-239.36V704a128 128 0 0 1-128 128H320a128 128 0 0 1-128-128V320a128 128 0 0 1 128-128h146.304z" fill="#FFFFFF" p-id="7673"></path><path d="M788.992 267.008a32 32 0 0 1 0 45.248l-316.8 316.8a32 32 0 0 1-45.184-45.312l316.8-316.8a32 32 0 0 1 45.184 0z" fill="#FFFFFF" p-id="7674"></path></svg>
                    编辑
                </a>
                {% if role == '超级管理员' %}
                <a onclick="removeUser('{{ user.username }}')" class="card-btn cursor-pointer" data-bs-toggle="modal" data-bs-target="#modal-danger">
                    <svg t="1635400029781" class="icon me-2 text-muted" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="17941" width="200" height="200"><path d="M877.79 217.23H624.22c0-36.02-29.2-65.23-65.23-65.23H465c-36.02 0-65.23 29.2-65.23 65.23H146.21c-18.01 0-32.61 14.6-32.61 32.61 0 18.01 14.6 32.61 32.61 32.61h49.75l14.43 528.79c1.06 33.91 25.21 60.76 54.64 60.76h493.93c29.43 0 53.58-26.86 54.64-60.76l14.48-528.79h49.7c18.01 0 32.61-14.6 32.61-32.61 0.01-18.01-14.59-32.61-32.6-32.61zM364.24 748.41c-17.98 0.82-33.4-10.01-34.44-24.19L308 427.56c-1.04-14.18 12.69-26.34 30.67-27.16 17.98-0.82 33.4 10.01 34.45 24.19l21.8 296.67c1.04 14.17-12.7 26.33-30.68 27.15z m180.37-25.42c0 14.2-14.6 25.72-32.61 25.72-18.01 0-32.61-11.51-32.61-25.72V425.83c0-14.2 14.6-25.72 32.61-25.72 18.01 0 32.61 11.51 32.61 25.72v297.16zM716 427.56l-21.8 296.67c-1.04 14.18-16.46 25.01-34.44 24.19-17.98-0.82-31.71-12.98-30.67-27.16l21.8-296.67c1.04-14.18 16.46-25.01 34.44-24.19 17.98 0.82 31.72 12.98 30.67 27.16z" fill="#FF5D5D" p-id="17942"></path></svg>
                    删除
                </a>
                {% endif %}
            </div>
        </div>
    </div>
    {% empty %}
    <div class="empty">
        <div class="empty-img">
        <?xml version="1.0" encoding="UTF-8"?>
        <svg width="244px" height="208px" viewBox="0 0 244 208" version="1.1" xmlns="http://www.w3.org/2000/svg">
            <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                <g id="亮背景时使用" transform="translate(-544.000000, -904.000000)">
                    <g id="暂无相关搜索、搜索、帮助、疑问" transform="translate(544.000000, 904.000000)">
                        <g id="背景/彩">
                            <g id="-">
                                <g id="编组" transform="translate(28.400000, 18.400000)">
                                    <polyline id="路径" stroke="#DEF5FF" stroke-width="40" stroke-linecap="round" stroke-linejoin="round" points="121.6 27.4476562 49.6 71.0238281 121.6 66.6 129.6 66.6 72.167827 114.6"></polyline>
                                    <path d="M1.6,146.2 C0.7163444,146.2 -5.68434189e-14,145.483656 -5.68434189e-14,144.6 C-5.68434189e-14,143.716344 0.7163444,143 1.6,143 L141.6,143 C142.483656,143 143.2,143.716344 143.2,144.6 C143.2,145.483656 142.483656,146.2 141.6,146.2 L1.6,146.2 Z M149.6,146.2 C148.716344,146.2 148,145.483656 148,144.6 C148,143.716344 148.716344,143 149.6,143 L154.6,143 C155.483656,143 156.2,143.716344 156.2,144.6 C156.2,145.483656 155.483656,146.2 154.6,146.2 L149.6,146.2 Z M167.6,146.2 C166.716344,146.2 166,145.483656 166,144.6 C166,143.716344 166.716344,143 167.6,143 L185.6,143 C186.483656,143 187.2,143.716344 187.2,144.6 C187.2,145.483656 186.483656,146.2 185.6,146.2 L167.6,146.2 Z M47.6,161.2 C46.7163444,161.2 46,160.483656 46,159.6 C46,158.716344 46.7163444,158 47.6,158 L61.6,158 C62.4836556,158 63.2,158.716344 63.2,159.6 C63.2,160.483656 62.4836556,161.2 61.6,161.2 L47.6,161.2 Z M70.6,161.2 C69.7163444,161.2 69,160.483656 69,159.6 C69,158.716344 69.7163444,158 70.6,158 L131.6,158 C132.483656,158 133.2,158.716344 133.2,159.6 C133.2,160.483656 132.483656,161.2 131.6,161.2 L70.6,161.2 Z M160,105.6 C160,103.466667 163.2,103.466667 163.2,105.6 L163.2,111.6 C163.2,112.483656 162.483656,113.2 161.6,113.2 L155.6,113.2 C153.466667,113.2 153.466667,110 155.6,110 L160,110 L160,105.6 Z M163.2,117.6 C163.2,119.733333 160,119.733333 160,117.6 L160,111.6 C160,110.716344 160.716344,110 161.6,110 L167.6,110 C169.733333,110 169.733333,113.2 167.6,113.2 L163.2,113.2 L163.2,117.6 Z M8,57.6 C8,55.4666667 11.2,55.4666667 11.2,57.6 L11.2,63.6 C11.2,64.4836556 10.4836556,65.2 9.6,65.2 L3.6,65.2 C1.46666667,65.2 1.46666667,62 3.6,62 L8,62 L8,57.6 Z M156.2,7 L161.6,7 C163.733333,7 163.733333,10.2 161.6,10.2 L156.2,10.2 L156.2,15.6 C156.2,17.7333333 153,17.7333333 153,15.6 L153,10.2 L147.6,10.2 C145.466667,10.2 145.466667,7 147.6,7 L153,7 L153,1.6 C153,-0.533333333 156.2,-0.533333333 156.2,1.6 L156.2,7 Z M11.2,69.6 C11.2,71.7333333 8,71.7333333 8,69.6 L8,63.6 C8,62.7163444 8.7163444,62 9.6,62 L15.6,62 C17.7333333,62 17.7333333,65.2 15.6,65.2 L11.2,65.2 L11.2,69.6 Z" id="Path-2" fill="#333745" fill-rule="nonzero"></path>
                                    <path d="M28.1857864,122.286292 C29.1285955,121.343482 30.542809,122.757696 29.6,123.700505 L27.4786797,125.821825 C27.0881554,126.21235 26.4549904,126.21235 26.0644661,125.821825 L23.9431458,123.700505 C23.0003367,122.757696 24.4145503,121.343482 25.3573593,122.286292 L26.7715729,123.700505 L28.1857864,122.286292 Z M25.3573593,127.943146 C24.4145503,128.885955 23.0003367,127.471741 23.9431458,126.528932 L26.0644661,124.407612 C26.4549904,124.017088 27.0881554,124.017088 27.4786797,124.407612 L29.6,126.528932 C30.542809,127.471741 29.1285955,128.885955 28.1857864,127.943146 L26.7715729,126.528932 L25.3573593,127.943146 Z M45.8426407,17.6 C46.7854497,16.657191 48.1996633,18.0714045 47.2568542,19.0142136 L45.1355339,21.1355339 C44.7450096,21.5260582 44.1118446,21.5260582 43.7213203,21.1355339 L41.6,19.0142136 C40.657191,18.0714045 42.0714045,16.657191 43.0142136,17.6 L44.4284271,19.0142136 L45.8426407,17.6 Z M43.0142136,23.2568542 C42.0714045,24.1996633 40.657191,22.7854497 41.6,21.8426407 L43.7213203,19.7213203 C44.1118446,19.3307961 44.7450096,19.3307961 45.1355339,19.7213203 L47.2568542,21.8426407 C48.1996633,22.7854497 46.7854497,24.1996633 45.8426407,23.2568542 L44.4284271,21.8426407 L43.0142136,23.2568542 Z" id="Path复制" fill="#657180" fill-rule="nonzero"></path>
                                </g>
                            </g>
                        </g>
                    <g id="Group-6" transform="translate(74.000000, 58.000000)">
                        <g id="分组">
                            <path d="M6,-1.0658141e-14 L70,-1.0658141e-14 C73.3137085,-1.12668594e-14 76,2.6862915 76,6 L76,84 C76,87.3137085 73.3137085,90 70,90 L6,90 C2.6862915,90 4.05812251e-16,87.3137085 0,84 L0,6 C-4.05812251e-16,2.6862915 2.6862915,-1.00494227e-14 6,-1.0658141e-14 Z" id="矩形" fill="#FDFFED"></path>
                            <path d="M76,78.5908203 L76,84 C76,87.3137085 73.3137085,90 70,90 L6,90 C2.6862915,90 4.05812251e-16,87.3137085 0,84 L0,6 C-4.05812251e-16,2.6862915 2.6862915,-1.00494227e-14 6,-1.0658141e-14 L6,-1.0658141e-14 L70,-1.0658141e-14 C73.3137085,-1.12668594e-14 76,2.6862915 76,6 L76,6" id="路径" stroke="#333745" stroke-width="3.2" stroke-linecap="round"></path>
                            <path d="M15.6,53.6 L25.6,53.6 L15.6,53.6 Z M15.6,39.6 L23.6,39.6 L15.6,39.6 Z M15.6,25.6 L27.6,25.6 L15.6,25.6 Z" id="Stroke-16" stroke="#333745" stroke-width="2.8" stroke-linecap="round" stroke-linejoin="round"></path>
                        </g>
                        <g id="分组-2" transform="translate(30.000000, 8.000000)">
                            <path d="M53.6900461,50.0203149 L65.6900461,50.0203149 L65.6740471,71.8249332 C65.6716152,75.1393527 62.9840651,77.8249316 59.6696447,77.8249316 L59.6696447,77.8249316 C56.3583667,77.8249316 53.6740455,75.1406104 53.6740455,71.8293325 C53.6740455,71.827866 53.6740461,71.8263996 53.6740471,71.8249332 L53.6900461,50.0203149 Z" id="矩形" stroke="#333745" stroke-width="3.2" fill="#D0E639" transform="translate(59.679845, 63.922623) rotate(-42.000000) translate(-59.679845, -63.922623) "></path>
                            <circle id="椭圆形" stroke="#333745" stroke-width="3.2" fill="#D0E639" cx="33" cy="33" r="33"></circle>
                            <circle id="椭圆形-copy" stroke="#333745" stroke-width="3.2" fill="#FBFFE3" cx="33" cy="33" r="25"></circle>
                            <path d="M35.2263184,39.37 C34.6182335,39.5850928 31.4098378,39.6020605 30.8698378,39.37 C30.3298378,39.1379395 30.2698378,38.86 30.2698378,37.99 C30.2698378,35.92 30.6298378,34.72 31.5898378,33.55 C32.3098378,32.71 32.5498378,32.53 34.6798378,31.24 C36.1498378,30.37 36.6298378,29.74 36.6298378,28.75 C36.6298378,27.34 35.5798378,26.5 33.7798378,26.5 C32.4298378,26.5 31.4398378,26.98 30.8698378,27.91 C30.5698378,28.39 30.3898378,28.5682568 30.3298378,29.74 C30.2698378,30.9117432 23.9638672,31.24 24.1498378,29.17 C24.3358084,27.1 24.9298378,25.84 26.0698378,24.58 C27.8098378,22.6 30.4798378,21.58 33.9298378,21.58 C39.4498378,21.58 42.8998378,24.19 42.8998378,28.33 C42.8998378,30.16 42.2998378,31.57 41.0398378,32.74 C40.3198378,33.4 40.0198378,33.61 37.4098378,35.23 C36.1498378,36.04 35.6998378,36.82 35.6998378,38.2 C35.6998378,38.56 35.8344032,39.1549072 35.2263184,39.37 Z M32.8348378,41.41 L33.1948378,41.41 C34.7605651,41.41 36.0298378,42.6792727 36.0298378,44.245 L36.0298378,44.245 C36.0298378,45.8107273 34.7605651,47.08 33.1948378,47.08 L32.8348378,47.08 C31.2691105,47.08 29.9998378,45.8107273 29.9998378,44.245 L29.9998378,44.245 C29.9998378,42.6792727 31.2691105,41.41 32.8348378,41.41 Z" id="？" fill="#333745" fill-rule="nonzero"></path>
                        </g>
                    </g>
                </g>
            </g>
            </g>
        </svg>
    </div>
        <p class="empty-title">没有用户</p>
    </div>
    {% endfor %}
</div>

<div class="modal modal-blur fade" id="modal-user-info" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-small" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">用户信息</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="mb-2">
                    <svg t="1662280009949" class="icon me-2 text-muted" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="27352" width="50" height="50"><path d="M904.4 346.2c-21.5-50.7-52.2-96.3-91.3-135.4-39.1-39.1-84.6-69.8-135.4-91.3C625.3 97.4 569.5 86.1 512 86.1s-113.3 11.3-165.8 33.5c-50.7 21.5-96.3 52.2-135.4 91.3-39.1 39.1-69.8 84.6-91.3 135.4C97.4 398.7 86.1 454.5 86.1 512c0 57.5 11.3 113.3 33.5 165.8 21.5 50.7 52.2 96.3 91.3 135.4 39.1 39.1 84.6 69.8 135.4 91.3 52.5 22.2 108.3 33.5 165.8 33.5s113.3-11.3 165.8-33.5c50.7-21.5 96.3-52.2 135.4-91.3 39.1-39.1 69.8-84.6 91.3-135.4 22.2-52.5 33.5-108.3 33.5-165.8-0.2-57.5-11.5-113.3-33.7-165.8zM770.7 770.7c-69.1 69.1-161 107.2-258.7 107.2s-189.6-38.1-258.7-107.2-107.2-161-107.2-258.7 38.1-189.6 107.2-258.7 161-107.2 258.7-107.2 189.6 38.1 258.7 107.2 107.2 161 107.2 258.7-38.1 189.6-107.2 258.7z" p-id="27353"></path><path d="M618.9 552.8c47.3-33.6 78.2-88.7 78.2-151 0-102-83-185.1-185.1-185.1s-185.1 83-185.1 185.1c0 62.3 30.9 117.4 78.2 151-67.5 32.9-118.4 96-133.4 173.5-3.1 16.3 7.5 32 23.8 35.1 1.9 0.4 3.8 0.5 5.7 0.5 14.1 0 26.7-10 29.4-24.3 16.7-86.6 93-149.5 181.3-149.5 88.4 0 164.6 62.9 181.3 149.5 3.1 16.3 18.9 26.9 35.1 23.8 16.3-3.1 26.9-18.9 23.8-35.1-14.8-77.6-65.7-140.7-133.2-173.5zM512 276.7c69 0 125.1 56.1 125.1 125.1s-56.1 125-125.1 125-125.1-56.1-125.1-125.1 56.1-125 125.1-125z" p-id="27354"></path></svg>
                    用户名: <strong class="info-username"></strong>
                </div>
                <div class="mb-2">
                    <svg t="1662278318359" class="icon me-2 text-muted" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="16927" width="50" height="50"><path d="M683.281067 68.266667a34.133333 34.133333 0 0 1 24.917333 10.786133l204.151467 217.429333a34.133333 34.133333 0 0 1 9.250133 23.381334V785.066667a170.666667 170.666667 0 0 1-170.666667 170.666666H273.066667a170.666667 170.666667 0 0 1-170.666667-170.666666V238.933333a170.666667 170.666667 0 0 1 170.666667-170.666666z m-14.7456 68.266666H273.066667a102.4 102.4 0 0 0-102.4 102.4v546.133334a102.4 102.4 0 0 0 102.4 102.4h477.866666a102.4 102.4 0 0 0 102.4-102.4V333.380267L668.535467 136.533333z m-2.935467 213.333334a34.133333 34.133333 0 0 1 0 68.266666H546.133333v290.133334a34.133333 34.133333 0 0 1-68.266666 0v-290.133334h-119.466667a34.133333 34.133333 0 0 1 0-68.266666h307.2z" fill="#2B2B36" p-id="16928"></path></svg>
                    昵称: <strong class="info-nickname"></strong>
                </div>
                <div class="mb-2">
                    <svg t="1662279950142" class="icon me-2 text-muted" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="26378" width="50" height="50"><path d="M508.765329 548.912701c-45.568848 0-82.642209 37.07336-82.642209 82.643232 0 18.119683 5.760191 35.320437 16.660448 49.740868 0.233314 0.309038 0.475837 0.60989 0.727571 0.903579 20.418029 23.793916 21.900799 40.779775 21.995967 42.336224l0 47.197952c0 23.853267 19.405979 43.258223 43.259246 43.258223 23.854291 0 43.259246-19.405979 43.259246-43.258223l0-48.088228c0-0.540306-0.022513-1.081635-0.069585-1.61887-0.004093-0.041956 0.10847-0.010233 0.112564-0.051165 0.118704-1.083681 0.481977-3.40147 1.586125-6.759961 2.219551-6.750751 7.442506-17.812691 19.729344-32.177863 0.178055-0.207731 0.350994-0.419556 0.51984-0.635473 11.453866-14.646582 17.508769-32.229029 17.508769-50.846038C591.411631 585.987085 554.337247 548.912701 508.765329 548.912701zM544.67212 659.078777c-28.900214 33.943067-30.3134 58.252729-30.039153 65.054645l0 47.602158c0 3.234671-2.631944 5.865591-5.866614 5.865591s-5.865591-2.63092-5.865591-5.865591l0-47.423079c0.002047-3.491521-0.960885-31.193443-30.592762-65.973574-5.753027-7.791453-8.791224-17.040095-8.791224-26.782993 0-24.951275 20.299325-45.2506 45.249577-45.2506 24.953322 0 45.254693 20.299325 45.254693 45.2506C554.018999 641.621173 550.788421 651.128711 544.67212 659.078777z" p-id="26379"></path><path d="M822.680878 390.411781l-45.819558 0L776.86132 270.363637c0-0.793062-0.050142-1.586125-0.150426-2.37407-8.16496-63.780629-39.282678-122.508171-87.62264-165.366282-48.76361-43.233664-111.545492-67.042929-176.778192-67.042929-71.203692 0-138.146337 27.728528-188.494025 78.076216-50.349735 50.348712-78.07724 117.291356-78.07724 188.496072l0 88.22946-50.883901 0.029676c-35.176151 0-63.792908 28.617781-63.792908 63.792908l0 452.057793c0 35.175127 28.616758 63.791885 63.792908 63.791885l389.759935 0c0.567935 0 1.12973-0.024559 1.684362-0.074701l234.697323 0c0.555655 0.050142 1.11745 0.074701 1.684362 0.074701 35.175127 0 63.791885-28.616758 63.791885-63.791885L886.472763 454.204689C886.472763 419.029562 857.856006 390.411781 822.680878 390.411781zM849.080132 906.262482c0 13.886265-10.778484 25.303292-24.408923 26.324552-0.051165 0-0.103354 0-0.154519 0L578.913992 932.587034c-0.567935 0-1.12973 0.024559-1.684362 0.074701L194.853873 932.661735c-14.557554 0-26.399253-11.842723-26.399253-26.399253L168.45462 454.204689c0-14.557554 11.842723-26.400277 26.399253-26.400277l69.590961-0.040932c0.952698-0.001023 1.88186-0.095167 2.796696-0.233314 1.003863 0.166799 2.028193 0.275269 3.080152 0.275269l352.928075 0c0.336668 0.007163 0.857531 0.014326 1.547239 0.014326 9.410324 0 50.318012-1.431605 85.968977-24.945135 8.620331-5.685489 10.998495-17.281595 5.313006-25.901926-5.686513-8.620331-17.283642-10.997472-25.901926-5.313006-29.55206 19.491936-65.778122 18.771529-66.081021 18.762319-0.204661-0.007163-0.410346-0.010233-0.617054-0.010233L283.131429 390.411781l0-88.26016c0-61.216223 23.838941-118.767987 67.124793-162.054863 43.285852-43.285852 100.837616-67.12377 162.053839-67.12377 56.08332 0 110.053512 20.466124 151.971204 57.629535 41.277102 36.594453 67.946508 86.618776 75.188446 140.975778l0 136.27471c0 1.673106 0.225127 3.339048 0.667196 4.951779l0.344854 1.254573c2.229784 8.117888 9.610892 13.744026 18.028609 13.744026l64.171532 0c14.556531 0 26.399253 11.842723 26.399253 26.400277L849.081155 906.262482z" p-id="26380"></path></svg>
                    密码: <strong class="info-password"></strong>
                </div>
                <div class="mb-2">
                    <svg t="1662279626544" class="icon me-2 text-muted" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="22018" width="50" height="50"><path d="M1004.8 352L524.8 115.2c-6.4-6.4-19.2-6.4-25.6 0L19.2 352c-12.8 0-19.2 12.8-19.2 25.6s6.4 25.6 19.2 25.6L499.2 640c6.4 0 6.4 6.4 12.8 6.4s6.4 0 12.8-6.4l377.6-185.6v268.8c0 19.2 12.8 32 32 32s32-12.8 32-32V422.4l38.4-19.2c12.8 0 19.2-12.8 19.2-25.6s-6.4-25.6-19.2-25.6zM512 576L102.4 377.6 512 179.2l409.6 198.4L512 576z" fill="" p-id="22019"></path><path d="M793.6 576c-19.2 0-32 12.8-32 32v185.6c-140.8 64-358.4 64-499.2 0V608c0-19.2-12.8-32-32-32s-32 12.8-32 32v204.8c0 12.8 6.4 25.6 19.2 25.6 83.2 44.8 185.6 64 294.4 64s211.2-25.6 294.4-64c12.8-6.4 19.2-19.2 19.2-25.6V608c0-19.2-12.8-32-32-32z" fill="" p-id="22020"></path></svg>
                    角色: <strong class="info-role"></strong>
                </div>
                <div class="mb-2">
                    <svg t="1662279908574" class="icon me-2 text-muted" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="25387" width="50" height="50"><path d="M906.36288 815.08352H130.21184V254.60736h776.13056v560.47616z m-735.19104-40.96h694.21056V295.56736H171.17184v478.55616z" fill="#070606" p-id="25388"></path><path d="M518.30784 559.9232L138.87488 291.81952l23.6544-33.46432 355.77856 251.41248 355.75808-251.41248 23.63392 33.46432z" fill="#070606" p-id="25389"></path></svg>
                    邮箱: <strong class="info-email"></strong>
                </div>
                <div class="mb-2">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2 text-muted" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><rect x="4" y="5" width="16" height="16" rx="2" /><line x1="16" y1="3" x2="16" y2="7" /><line x1="8" y1="3" x2="8" y2="7" /><line x1="4" y1="11" x2="20" y2="11" /><line x1="11" y1="15" x2="12" y2="15" /><line x1="12" y1="15" x2="12" y2="18" /></svg>
                    加入日期: <strong class="info-ctime"></strong>
                </div>
            </div>
        </div>
    </div>
</div>


<div class="modal modal-blur fade" id="modal-new-user" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-small" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">创建用户</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="form-selectgroup-boxes row">
                    <div class="col-lg-6">
                        <label class="form-selectgroup-item">
                            <input type="radio" name="new-role" value="普通用户" class="form-selectgroup-input" checked>
                            <span class="form-selectgroup-label d-flex align-items-center p-3">
                                <span class="me-3">
                                    <span class="form-selectgroup-check"></span>
                                </span>
                                <span class="form-selectgroup-label-content">
                                    <span class="form-selectgroup-title strong mb-1">普通用户</span>
                                </span>
                            </span>
                        </label>
                    </div>
                    <div class="col-lg-6">
                        <label class="form-selectgroup-item">
                            <input type="radio" name="new-role" value="管理员" class="form-selectgroup-input">
                            <span class="form-selectgroup-label d-flex align-items-center p-3">
                                <span class="me-3">
                                    <span class="form-selectgroup-check"></span>
                                </span>
                                <span class="form-selectgroup-label-content">
                                    <span class="form-selectgroup-title strong mb-1">管理员</span>
                                </span>
                            </span>
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-lg-6">
                        <div class="mb-3">
                            <label class="form-label">账号</label>
                            <input id="create-username" type="text" class="form-control" placeholder="请输入账号名称">
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="mb-3">
                            <label class="form-label">密码</label>
                            <input id="create-password" type="text" class="form-control" placeholder="请输入密码名称">
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="mb-3">
                            <label class="form-label">昵称</label>
                            <input id="create-nickname" type="text" class="form-control" placeholder="请输入昵称">
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="mb-3">
                            <label class="form-label">邮箱</label>
                            <input id="create-email" type="text" class="form-control" placeholder="请输入邮箱">
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <a  class="btn btn-link link-secondary" data-bs-dismiss="modal">取消</a>
                <a  onclick="createUser()" class="btn btn-primary ms-auto">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><line x1="12" y1="5" x2="12" y2="19" /><line x1="5" y1="12" x2="19" y2="12" /></svg>
                    创建
                </a>
            </div>
        </div>
    </div>
</div>

<div class="modal modal-blur fade" id="modal-edit-user" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-small" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">编辑用户信息</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="form-selectgroup-boxes row">
                    <div class="col-lg-6">
                        <label class="form-selectgroup-item">
                            <input type="radio" name="edit-role" value="普通用户" class="form-selectgroup-input" checked>
                            <span class="form-selectgroup-label d-flex align-items-center p-3">
                                <span class="me-3">
                                    <span class="form-selectgroup-check"></span>
                                </span>
                                <span class="form-selectgroup-label-content">
                                    <span class="form-selectgroup-title strong mb-1">普通用户</span>
                                </span>
                            </span>
                        </label>
                    </div>
                    <div class="col-lg-6">
                        <label class="form-selectgroup-item">
                            <input type="radio" name="edit-role" value="管理员" class="form-selectgroup-input">
                            <span class="form-selectgroup-label d-flex align-items-center p-3">
                                <span class="me-3">
                                    <span class="form-selectgroup-check"></span>
                                </span>
                                <span class="form-selectgroup-label-content">
                                    <span class="form-selectgroup-title strong mb-1">管理员</span>
                                </span>
                            </span>
                        </label>
                    </div>
                </div>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-lg-6">
                        <div class="mb-3">
                            <label class="form-label">账号</label>
                            <input id="edit-username" disabled type="text" class="form-control" placeholder="请输入账号名称">
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="mb-3">
                            <label class="form-label">密码</label>
                            <input id="edit-password" type="text" class="form-control" placeholder="请输入密码名称">
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="mb-3">
                            <label class="form-label">昵称</label>
                            <input id="edit-nickname" type="text" class="form-control" placeholder="请输入昵称">
                        </div>
                    </div>
                    <div class="col-lg-6">
                        <div class="mb-3">
                            <label class="form-label">邮箱</label>
                            <input id="edit-email" type="text" class="form-control" placeholder="请输入邮箱">
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <a  class="btn btn-link link-secondary" data-bs-dismiss="modal">取消</a>
                <a id="update-confirm" class="btn btn-info ms-auto">
                    <svg t="1638686890624" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="8488" width="200" height="200"><path d="M286.487273 759.854545c-5.818182 0-11.403636-2.094545-16.058182-6.283636a354.816 354.816 0 0 1-111.010909-257.163636c0-30.487273 3.956364-60.741818 11.636363-90.065455 3.258182-12.567273 16.058182-19.781818 28.392728-16.523636s19.781818 16.058182 16.523636 28.392727c-6.749091 25.367273-10.007273 51.898182-10.007273 78.429091 0 85.410909 34.210909 164.770909 96.349091 223.185455a23.179636 23.179636 0 0 1-15.825454 40.02909zM510.370909 848.756364c-6.516364 0-13.032727-2.792727-17.454545-7.68s-6.981818-11.170909-6.283637-17.687273l4.189091-53.527273-89.832727 43.054546c-6.981818 10.705455-20.712727 13.265455-31.650909 6.283636-10.705455-6.981818-13.498182-21.876364-6.516364-32.814545 4.421818-6.749091 10.472727-12.101818 18.152727-15.592728l92.16-44.218182c14.429091-6.981818 31.185455-5.818182 44.683637 3.49091 13.265455 9.076364 20.712727 24.669091 19.549091 40.727272l-2.327273 30.021818C691.432727 788.247273 814.545455 656.523636 814.545455 496.407273c0-90.298182-39.563636-175.476364-108.218182-233.890909a23.505455 23.505455 0 0 1-2.792728-32.814546c8.378182-9.774545 23.04-10.938182 32.814546-2.792727 79.127273 67.258182 124.741818 165.469091 124.741818 269.265454 0 194.327273-157.323636 352.581818-350.72 352.581819z m-19.549091-81.221819zM261.818182 305.570909a23.249455 23.249455 0 0 1-17.687273-38.4c66.792727-78.196364 163.84-123.112727 266.24-123.112727 6.516364 0 13.032727 2.792727 17.454546 7.68s6.981818 11.170909 6.283636 17.687273l-4.189091 53.527272 89.832727-43.054545c6.981818-10.705455 20.945455-13.265455 31.650909-6.283637 10.705455 6.981818 13.498182 21.876364 6.516364 32.814546-4.421818 6.749091-10.472727 12.101818-18.152727 15.592727l-92.16 44.218182c-14.661818 6.981818-31.185455 5.585455-44.683637-3.490909-13.265455-9.076364-20.712727-24.669091-19.549091-40.727273l2.327273-30.021818c-79.825455 6.516364-153.832727 44.218182-206.196363 105.658182-4.654545 5.12-11.170909 7.912727-17.687273 7.912727z" fill="#ffffff" p-id="8489"></path><path d="M528.290909 270.429091c-8.843636 0-17.687273-2.792727-25.367273-7.912727-13.265455-9.076364-20.712727-24.669091-19.549091-40.727273l7.912728-102.4c1.163636-16.290909 10.705455-30.254545 25.367272-37.236364 14.661818-6.981818 31.650909-5.818182 45.149091 3.258182l84.48 58.181818c20.48 14.661818 25.6 42.821818 11.403637 63.069091-3.956364 6.050909-10.007273 11.403636-17.687273 15.127273l-92.16 44.218182c-6.283636 2.792727-13.032727 4.421818-19.549091 4.421818z m9.309091-145.454546l-7.68 98.676364 89.832727-43.985454-42.123636-26.763637-40.029091-27.927273zM506.647273 223.418182zM484.305455 915.316364c-8.843636 0-17.687273-2.56-25.367273-7.912728 0 0-0.232727 0-0.232727-0.232727l-84.247273-58.181818a45.777455 45.777455 0 0 1-11.403637-63.069091c3.956364-6.050909 10.007273-11.403636 17.687273-14.894545l92.16-44.218182c14.429091-6.981818 31.185455-5.818182 44.683637 3.490909 13.265455 9.076364 20.712727 24.669091 19.54909 40.727273l-7.912727 102.4c-1.163636 16.290909-10.705455 30.254545-25.367273 37.236363-6.050909 3.025455-12.8 4.654545-19.54909 4.654546z m6.283636-145.454546l-89.832727 43.054546 42.123636 26.763636 40.727273 28.392727 6.981818-98.210909z m0.232727-2.327273z" fill="#ffffff" p-id="8490"></path></svg>
                    更新
                </a>
            </div>
        </div>
    </div>
</div>

<div class="modal modal-blur fade" id="modal-danger" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog modal-sm modal-dialog-centered" role="document">
        <div class="modal-content">
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            <div class="modal-status bg-danger"></div>
            <div class="modal-body text-center py-4">
                <svg xmlns="http://www.w3.org/2000/svg" class="icon mb-2 text-danger icon-lg" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 9v2m0 4v.01" /><path d="M5 19h14a2 2 0 0 0 1.84 -2.75l-7.1 -12.25a2 2 0 0 0 -3.5 0l-7.1 12.25a2 2 0 0 0 1.75 2.75" /></svg>
                <h3>确认删除?</h3>
                <div class="text-muted user-name"></div>
            </div>
            <div class="modal-footer">
                <div class="w-100">
                    <div class="row">
                        <div class="col">
                            <a  class="btn btn-white w-100" data-bs-dismiss="modal">
                            取消
                            </a>
                        </div>
                        <div class="col">
                            <a  id="remove-confirm" class="btn btn-danger w-100">
                            确认
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block script %}
<script>

    function seachUser() {
        var keywords = $('#input-search').val().trim();
        var reg = new RegExp(keywords, 'i');

        $('.row-cards div.user-card').each(function(){
            var filter_username = $(this).children('div.card-body').children('h3.username').text().trim().search(reg) !== -1;
            var filter_nickname = $(this).children('div.card-body').children('div.nickname').text().trim().search(reg) !== -1;
            if(keywords){
                if(filter_username || filter_nickname){
                    $(this).show();
                }else{
                    $(this).hide();
                }
            }else{
                $(this).show();
            }
        });
    };

    function createUser() {
        var username = document.getElementById("create-username").value.trim();
        var password = document.getElementById("create-password").value.trim();
        var nickname = document.getElementById("create-nickname").value.trim();
        var email = document.getElementById("create-email").value.trim();
        if(username && password && nickname){
            $.ajax({
                url: "/user/api/create",
                type: "POST",
                async: false,
                data: {
                    username: username,
                    password: password,
                    nickname: nickname,
                    email: email,
                    role: $("input[name='new-role']:checked").val()
                },
                beforeSend: function () {
                    loading();
                },
                complete: function () {
                    removeLoading();
                },
                success: function (data) {
                    if (data['status'] == 1) {
                        rute("/user/list/page=1");
                    }
                    else{
                        Spop(SPOP_TYPE['error'],data['msg']);
                    }
                }
            });
        }else {
            Spop(SPOP_TYPE['error'],'帐号、密码、昵称不能为空');
        }
    }

    function getUserInfo(username) {
        $.ajax({
            url: "/user/api/info",
            type: "POST",
            async: false,
            data: {
                username: username,
            },
            beforeSend: function () {
                loading();
            },
            complete: function () {
                removeLoading();
            },
            success: function (data) {
                if (data['status'] == 1) {
                    $('.info-username').text(username);
                    $('.info-password').text(data['data'][0]['password']);
                    $('.info-nickname').text(data['data'][0]['nickname']);
                    $('.info-role').text(data['data'][0]['role']);
                    $('.info-email').text(data['data'][0]['email']);
                    $('.info-ctime').text(data['data'][0]['ctime']);
                }
                else{
                    Spop(SPOP_TYPE['error'],data['msg']);
                }
            }
        });
    }

    function setUser(username) {
        $.ajax({
            url: "/user/api/info",
            type: "POST",
            async: false,
            data: {
                username: username,
            },
            beforeSend: function () {
                loading();
            },
            complete: function () {
                removeLoading();
            },
            success: function (data) {
                if (data['status'] == 1) {
                    $('#edit-username').val(username);
                    $('#edit-password').val(data['data'][0]['password']);
                    $('#edit-nickname').val(data['data'][0]['nickname']);
                    $('#edit-email').val(data['data'][0]['email']);
                    let edit_role = data['data'][0]['role'];
                    $("input:radio[name='edit-role'][value='" + edit_role + "']").prop("checked",true);

                }
                else{
                    Spop(SPOP_TYPE['error'],data['msg']);
                }
            }
        });
    }

    function editUser(username) {
        setUser(username);
        $('#update-confirm').on('click', function () {
            var password = document.getElementById("edit-password").value.trim();
            var nickname = document.getElementById("edit-nickname").value.trim();
            var email = document.getElementById("edit-email").value.trim();
            if(password && nickname){
                $.ajax({
                    url: "/user/api/edit",
                    type: "POST",
                    async: false,
                    data: {
                        username: username,
                        password: password,
                        nickname: nickname,
                        email: email,
                        role: $("input[name='edit-role']:checked").val()
                    },
                    beforeSend: function () {
                        loading();
                        },
                    complete: function () {
                        removeLoading();
                        },
                    success: function (data) {
                        if (data['status'] == 1) {
                            rute("/user/list/page=1");
                        }
                        else{
                            Spop(SPOP_TYPE['error'],data['msg']);
                        }
                    }
                });
            }
            else {
                Spop(SPOP_TYPE['error'],'密码、昵称不能为空');
            }
        });
    }

    function removeUser(username) {

        $('.user-name').text(username);

        $('#remove-confirm').on('click', function () {
            $.ajax({
                url: "/user/api/delete",
                type: "POST",
                async: false,
                data: {
                    username: username,
                },
                beforeSend: function () {
                    loading();
                },
                complete: function () {
                    removeLoading();
                },
                success: function (data) {
                    if (data['status'] == 1) {
                        rute("/user/list/page=1");
                    }
                    else{
                        Spop(SPOP_TYPE['error'],data['msg']);
                    }
                }
            });
        });
    }

</script>

{% endblock %}

