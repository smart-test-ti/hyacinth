{% extends 'site-base.html' %}
{% load static %}
{% block title %}APP列表 - 风信子{% endblock %}
{% block page_title %}APP列表{% endblock %}

{% block ms-auto %}
<div class="btn-list">
    <div class="input-icon">
        <span class="input-icon-addon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><circle cx="10" cy="10" r="7" /><line x1="21" y1="21" x2="15" y2="15" /></svg>
        </span>
        <input  id="input-keywords" type="text" value="" class="form-control" placeholder="搜索APP" aria-label="Search in website">
    </div>
    <a class="btn btn-teal d-none d-sm-inline-block" onclick="searchAPP()">
        <svg t="1663586631472" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5525" width="200" height="200"><path d="M901.9 845.7L772.1 715.9c51.3-63 82.2-143.3 82.2-230.7 0-201.9-164.2-366.1-366.1-366.1S122.1 283.3 122.1 485.2s164.2 366.1 366.1 366.1c92 0 175.9-34.4 240.3-90.6l129.2 129.2 44.2-44.2z m-413.7-57c-167.4 0-303.6-136.2-303.6-303.5 0-167.4 136.2-303.6 303.6-303.6 167.4 0 303.5 136.2 303.5 303.6 0 167.4-136.1 303.5-303.5 303.5z" p-id="5526" data-spm-anchor-id="a313x.7781069.0.i2" class="selected" fill="#ffffff"></path><path d="M488.2 485.2m-223.1 0a223.1 223.1 0 1 0 446.2 0 223.1 223.1 0 1 0-446.2 0Z" fill="#ffffff" p-id="5527" data-spm-anchor-id="a313x.7781069.0.i4" class="selected"></path></svg>
        查询
    </a>
</div>


{% endblock %}

{% block page_body %}

<div class="row row-cards">
    {% for package in packages%}
    <div class="col-md-6 col-lg-3">
        <a class="card card-link cursor-pointer" onclick="viewVersionFile('{{ package.pkgname }}', '{{ package.newest_version }}')">
            <div class="card-body">
                <div class="row">
                    <div class="col-auto">
                        {% if package.icon and package.icon != "" %}
                        <span class="avatar" style="background-image: url(/static/logo/{{ package.icon }});background-color:transparent;"></span>
                        {% else %}
                        <span class="avatar" style="background-image: url(/static/image/app.png);background-color:transparent;"></span>
                        {% endif %}
                    </div>
                    <div class="col">
                        <div class="font-weight-medium app-name" style="font-weight: bolder">{{ package.pkgname }}</div>
                        {% if package.newest_version %}
                        <div class="text-muted">最新版本: v{{ package.newest_version }}</div>
                        {% else %}
                        <div class="text-muted">没有版本</div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </a>
    </div>
    {% empty %}
    <div class="empty">
            <div class="empty-img">
                <?xml version="1.0" encoding="UTF-8"?>
                    <svg width="244px" height="208px" viewBox="0 0 244 208" version="1.1" xmlns="http://www.w3.org/2000/svg">
                        <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                            <g id="亮背景时使用" transform="translate(-544.000000, -904.000000)">
                                <g id="暂无相关搜索、搜索、帮助、疑问" transform="translate(544.000000, 904.000000)">
                                    <g id="背景/彩">
                                        <g id="-">
                                            <g id="编组" transform="translate(28.400000, 18.400000)">
                                                <polyline id="路径" stroke="#DEF5FF" stroke-width="40" stroke-linecap="round" stroke-linejoin="round" points="121.6 27.4476562 49.6 71.0238281 121.6 66.6 129.6 66.6 72.167827 114.6"></polyline>
                                                <path d="M1.6,146.2 C0.7163444,146.2 -5.68434189e-14,145.483656 -5.68434189e-14,144.6 C-5.68434189e-14,143.716344 0.7163444,143 1.6,143 L141.6,143 C142.483656,143 143.2,143.716344 143.2,144.6 C143.2,145.483656 142.483656,146.2 141.6,146.2 L1.6,146.2 Z M149.6,146.2 C148.716344,146.2 148,145.483656 148,144.6 C148,143.716344 148.716344,143 149.6,143 L154.6,143 C155.483656,143 156.2,143.716344 156.2,144.6 C156.2,145.483656 155.483656,146.2 154.6,146.2 L149.6,146.2 Z M167.6,146.2 C166.716344,146.2 166,145.483656 166,144.6 C166,143.716344 166.716344,143 167.6,143 L185.6,143 C186.483656,143 187.2,143.716344 187.2,144.6 C187.2,145.483656 186.483656,146.2 185.6,146.2 L167.6,146.2 Z M47.6,161.2 C46.7163444,161.2 46,160.483656 46,159.6 C46,158.716344 46.7163444,158 47.6,158 L61.6,158 C62.4836556,158 63.2,158.716344 63.2,159.6 C63.2,160.483656 62.4836556,161.2 61.6,161.2 L47.6,161.2 Z M70.6,161.2 C69.7163444,161.2 69,160.483656 69,159.6 C69,158.716344 69.7163444,158 70.6,158 L131.6,158 C132.483656,158 133.2,158.716344 133.2,159.6 C133.2,160.483656 132.483656,161.2 131.6,161.2 L70.6,161.2 Z M160,105.6 C160,103.466667 163.2,103.466667 163.2,105.6 L163.2,111.6 C163.2,112.483656 162.483656,113.2 161.6,113.2 L155.6,113.2 C153.466667,113.2 153.466667,110 155.6,110 L160,110 L160,105.6 Z M163.2,117.6 C163.2,119.733333 160,119.733333 160,117.6 L160,111.6 C160,110.716344 160.716344,110 161.6,110 L167.6,110 C169.733333,110 169.733333,113.2 167.6,113.2 L163.2,113.2 L163.2,117.6 Z M8,57.6 C8,55.4666667 11.2,55.4666667 11.2,57.6 L11.2,63.6 C11.2,64.4836556 10.4836556,65.2 9.6,65.2 L3.6,65.2 C1.46666667,65.2 1.46666667,62 3.6,62 L8,62 L8,57.6 Z M156.2,7 L161.6,7 C163.733333,7 163.733333,10.2 161.6,10.2 L156.2,10.2 L156.2,15.6 C156.2,17.7333333 153,17.7333333 153,15.6 L153,10.2 L147.6,10.2 C145.466667,10.2 145.466667,7 147.6,7 L153,7 L153,1.6 C153,-0.533333333 156.2,-0.533333333 156.2,1.6 L156.2,7 Z M11.2,69.6 C11.2,71.7333333 8,71.7333333 8,69.6 L8,63.6 C8,62.7163444 8.7163444,62 9.6,62 L15.6,62 C17.7333333,62 17.7333333,65.2 15.6,65.2 L11.2,65.2 L11.2,69.6 Z" id="Path-2" fill="#333745" fill-rule="nonzero"></path>
                                                <path d="M28.1857864,122.286292 C29.1285955,121.343482 30.542809,122.757696 29.6,123.700505 L27.4786797,125.821825 C27.0881554,126.21235 26.4549904,126.21235 26.0644661,125.821825 L23.9431458,123.700505 C23.0003367,122.757696 24.4145503,121.343482 25.3573593,122.286292 L26.7715729,123.700505 L28.1857864,122.286292 Z M25.3573593,127.943146 C24.4145503,128.885955 23.0003367,127.471741 23.9431458,126.528932 L26.0644661,124.407612 C26.4549904,124.017088 27.0881554,124.017088 27.4786797,124.407612 L29.6,126.528932 C30.542809,127.471741 29.1285955,128.885955 28.1857864,127.943146 L26.7715729,126.528932 L25.3573593,127.943146 Z M45.8426407,17.6 C46.7854497,16.657191 48.1996633,18.0714045 47.2568542,19.0142136 L45.1355339,21.1355339 C44.7450096,21.5260582 44.1118446,21.5260582 43.7213203,21.1355339 L41.6,19.0142136 C40.657191,18.0714045 42.0714045,16.657191 43.0142136,17.6 L44.4284271,19.0142136 L45.8426407,17.6 Z M43.0142136,23.2568542 C42.0714045,24.1996633 40.657191,22.7854497 41.6,21.8426407 L43.7213203,19.7213203 C44.1118446,19.3307961 44.7450096,19.3307961 45.1355339,19.7213203 L47.2568542,21.8426407 C48.1996633,22.7854497 46.7854497,24.1996633 45.8426407,23.2568542 L44.4284271,21.8426407 L43.0142136,23.2568542 Z" id="Path复制" fill="#657180" fill-rule="nonzero"></path>
                                            </g>
                                        </g>
                                    </g>
                                    <g id="Group-6" transform="translate(74.000000, 58.000000)">
                                        <g id="分组">
                                            <path d="M6,-1.0658141e-14 L70,-1.0658141e-14 C73.3137085,-1.12668594e-14 76,2.6862915 76,6 L76,84 C76,87.3137085 73.3137085,90 70,90 L6,90 C2.6862915,90 4.05812251e-16,87.3137085 0,84 L0,6 C-4.05812251e-16,2.6862915 2.6862915,-1.00494227e-14 6,-1.0658141e-14 Z" id="矩形" fill="#FDFFED"></path>
                                            <path d="M76,78.5908203 L76,84 C76,87.3137085 73.3137085,90 70,90 L6,90 C2.6862915,90 4.05812251e-16,87.3137085 0,84 L0,6 C-4.05812251e-16,2.6862915 2.6862915,-1.00494227e-14 6,-1.0658141e-14 L6,-1.0658141e-14 L70,-1.0658141e-14 C73.3137085,-1.12668594e-14 76,2.6862915 76,6 L76,6" id="路径" stroke="#333745" stroke-width="3.2" stroke-linecap="round"></path>
                                            <path d="M15.6,53.6 L25.6,53.6 L15.6,53.6 Z M15.6,39.6 L23.6,39.6 L15.6,39.6 Z M15.6,25.6 L27.6,25.6 L15.6,25.6 Z" id="Stroke-16" stroke="#333745" stroke-width="2.8" stroke-linecap="round" stroke-linejoin="round"></path>
                                        </g>
                                        <g id="分组-2" transform="translate(30.000000, 8.000000)">
                                            <path d="M53.6900461,50.0203149 L65.6900461,50.0203149 L65.6740471,71.8249332 C65.6716152,75.1393527 62.9840651,77.8249316 59.6696447,77.8249316 L59.6696447,77.8249316 C56.3583667,77.8249316 53.6740455,75.1406104 53.6740455,71.8293325 C53.6740455,71.827866 53.6740461,71.8263996 53.6740471,71.8249332 L53.6900461,50.0203149 Z" id="矩形" stroke="#333745" stroke-width="3.2" fill="#D0E639" transform="translate(59.679845, 63.922623) rotate(-42.000000) translate(-59.679845, -63.922623) "></path>
                                            <circle id="椭圆形" stroke="#333745" stroke-width="3.2" fill="#D0E639" cx="33" cy="33" r="33"></circle>
                                            <circle id="椭圆形-copy" stroke="#333745" stroke-width="3.2" fill="#FBFFE3" cx="33" cy="33" r="25"></circle>
                                            <path d="M35.2263184,39.37 C34.6182335,39.5850928 31.4098378,39.6020605 30.8698378,39.37 C30.3298378,39.1379395 30.2698378,38.86 30.2698378,37.99 C30.2698378,35.92 30.6298378,34.72 31.5898378,33.55 C32.3098378,32.71 32.5498378,32.53 34.6798378,31.24 C36.1498378,30.37 36.6298378,29.74 36.6298378,28.75 C36.6298378,27.34 35.5798378,26.5 33.7798378,26.5 C32.4298378,26.5 31.4398378,26.98 30.8698378,27.91 C30.5698378,28.39 30.3898378,28.5682568 30.3298378,29.74 C30.2698378,30.9117432 23.9638672,31.24 24.1498378,29.17 C24.3358084,27.1 24.9298378,25.84 26.0698378,24.58 C27.8098378,22.6 30.4798378,21.58 33.9298378,21.58 C39.4498378,21.58 42.8998378,24.19 42.8998378,28.33 C42.8998378,30.16 42.2998378,31.57 41.0398378,32.74 C40.3198378,33.4 40.0198378,33.61 37.4098378,35.23 C36.1498378,36.04 35.6998378,36.82 35.6998378,38.2 C35.6998378,38.56 35.8344032,39.1549072 35.2263184,39.37 Z M32.8348378,41.41 L33.1948378,41.41 C34.7605651,41.41 36.0298378,42.6792727 36.0298378,44.245 L36.0298378,44.245 C36.0298378,45.8107273 34.7605651,47.08 33.1948378,47.08 L32.8348378,47.08 C31.2691105,47.08 29.9998378,45.8107273 29.9998378,44.245 L29.9998378,44.245 C29.9998378,42.6792727 31.2691105,41.41 32.8348378,41.41 Z" id="？" fill="#333745" fill-rule="nonzero"></path>
                                        </g>
                                    </g>
                                </g>
                            </g>
                        </g>
                    </svg>
                </div>
                <p class="empty-title">未发现APP记录</p>
            </div>
    {% endfor %}
</div>


{% endblock %}

{% block base_script %}

<script>

     $(document).ready(function() {
         if('{{ app }}' != 'all'){
             $('#input-keywords').val('{{ app }}')
         }
     });

    function searchAPP() {
        var keywords = $('#input-keywords').val().trim();
        if(keywords){
            rute('/package/home/app='+keywords);
        }else{
            rute('/package/home/app=all');
        }

    };



    function viewVersionFile(pkgname,version) {
        if(version){
            rute('/package/list/app='+pkgname+'&version='+version)
        }else {
            $.ajax({
                url: "/package/api/version",
                type: "POST",
                async: false,
                data: {
                    pkgname: pkgname,
                },
                beforeSend: function () {
                    SwalLoading('Loading');
                    },
                complete: function () {
                    swal.close();
                    },
                success: function (data) {
                    if (data['version_list'].length > 0) {
                        rute('/package/list/app='+pkgname+'&version='+data['version_list'][0]);
                    }
                    else{
                        rute('/package/list/app='+pkgname+'&version=none');
                    }
                }
            });
        }

    }

</script>

{% endblock %}




